{"version":3,"file":"plugins/plugin.autoplay.js","mappings":"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","sources":["webpack://@internetarchive/bookreader/./src/BookReaderPlugin.js","webpack://@internetarchive/bookreader/./src/plugins/plugin.autoplay.js"],"sourcesContent":["// @ts-check\n/** @typedef {import(\"./BookReader.js\").default} BookReader */\n\n/**\n * @template TOptions\n */\nexport class BookReaderPlugin {\n  /**\n   * @param {BookReader} br\n   */\n  constructor(br) {\n    /** @type {BookReader} */\n    this.br = br;\n    /** @type {TOptions} */\n    this.options;\n  }\n\n  /**\n   * @abstract\n   * @param {TOptions} options\n   **/\n  setup(options) {\n    this.options = Object.assign({}, this.options, options);\n  }\n\n  /** @abstract */\n  init() {}\n\n  /**\n   * @abstract\n   * @protected\n   * @param {import (\"./BookReader/PageContainer.js\").PageContainer} pageContainer\n   */\n  _configurePageContainer(pageContainer) {\n  }\n\n  /**\n   * @abstract\n   * @protected\n   * @param {JQuery<HTMLElement>} $toolbarElement\n   */\n  _configureToolbar($toolbarElement) {\n  }\n\n  /** @abstract @protected */\n  _bindNavigationHandlers() {}\n\n  /**\n   * @param {JQuery<HTMLElement>} $navBar\n   */\n  extendNavBar($navBar) {}\n}\n","// @ts-check\nimport { EVENTS } from \"../BookReader/events\";\nimport { parseAnimationSpeed } from \"../BookReader/utils\";\nimport { BookReaderPlugin } from \"../BookReaderPlugin\";\n\n/**\n * Plugin which adds an autoplay feature. Useful for kiosk situations.\n */\nexport class AutoplayPlugin extends BookReaderPlugin {\n  options = {\n    enabled: true,\n    /**\n     * @type {number | 'fast' | 'slow'}\n     * How quickly the flip animation should run.\n     **/\n    flipSpeed: 1500,\n    /** How long to pause on each page between flips */\n    flipDelay: 5000,\n    /** Allow controlling the autoflip/speed/delay from the url */\n    urlParams: true,\n  }\n\n  timer = null;\n\n  /** @override */\n  init() {\n    if (!this.options.enabled) return;\n\n    this.br.bind(EVENTS.stop, () => this.stop());\n\n    if (this.options.urlParams) {\n      const urlParams = new URLSearchParams(window.location.search);\n      if (urlParams.get('flipSpeed')) {\n        this.options.flipSpeed = parseAnimationSpeed(urlParams.get('flipSpeed')) || this.options.flipSpeed;\n      }\n      if (urlParams.get('flipDelay')) {\n        this.options.flipDelay = parseAnimationSpeed(urlParams.get('flipDelay')) || this.options.flipDelay;\n      }\n      if (urlParams.get('autoflip') === '1') {\n        this.toggle();\n      }\n    }\n  }\n\n  /** @override */\n  _bindNavigationHandlers() {\n    if (!this.options.enabled) return;\n\n    const jIcons = this.br.$('.BRicon');\n\n    jIcons.filter('.play').on('click', () => {\n      this.toggle();\n      return false;\n    });\n\n    jIcons.filter('.pause').on('click', () => {\n      this.toggle();\n      return false;\n    });\n  }\n\n  /**\n   * Starts autoplay mode\n   * @param {object} overrides\n   * @param {number} overrides.flipSpeed\n   * @param {number} overrides.flipDelay\n   */\n  toggle(overrides = null) {\n    if (!this.options.enabled) return;\n\n    Object.assign(this.options, overrides);\n    this.br.trigger(EVENTS.stop);\n\n    let bComingFrom1up = false;\n    if (this.br.constMode2up != this.br.mode) {\n      bComingFrom1up = true;\n      this.br.switchMode(this.br.constMode2up);\n    }\n\n    if (null == this.timer) {\n      // $$$ Draw events currently cause layout problems when they occur during animation.\n      //     There is a specific problem when changing from 1-up immediately to autoplay in RTL so\n      //     we workaround for now by not triggering immediate animation in that case.\n      //     See https://bugs.launchpad.net/gnubook/+bug/328327\n      if (('rl' == this.br.pageProgression) && bComingFrom1up) {\n        // don't flip immediately -- wait until timer fires\n      } else {\n        // flip immediately\n        this.br.next({ triggerStop: false, flipSpeed: this.options.flipSpeed });\n      }\n\n      this.br.$('.play').hide();\n      this.br.$('.pause').show();\n      this.timer = setInterval(() => {\n        if (this.br.animating) return;\n\n        if (Math.max(this.br.twoPage.currentIndexL, this.br.twoPage.currentIndexR) >= this.br.book.getNumLeafs() - 1) {\n          this.br.prev({ triggerStop: false, flipSpeed: this.options.flipSpeed }); // $$$ really what we want?\n        } else {\n          this.br.next({ triggerStop: false, flipSpeed: this.options.flipSpeed });\n        }\n      }, parseAnimationSpeed(this.options.flipDelay));\n    } else {\n      this.stop();\n    }\n  }\n\n  /**\n   * Stop autoplay mode, allowing animations to finish\n   */\n  stop() {\n    if (!this.options.enabled) return;\n\n    if (null != this.timer) {\n      clearInterval(this.timer);\n      this.br.$('.pause').hide();\n      this.br.$('.play').show();\n      this.timer = null;\n    }\n  }\n}\n\nconst BookReader = /** @type {typeof import('../BookReader').default} */(window.BookReader);\nBookReader?.registerPlugin('autoplay', AutoplayPlugin);\n"],"names":["BookReaderPlugin","br","_classCallCheck","this","options","key","value","Object","assign","pageContainer","$toolbarElement","$navBar","AutoplayPlugin","_BookReaderPlugin","_this","_len","arguments","length","args","Array","_key","_defineProperty","_callSuper","concat","enabled","flipSpeed","flipDelay","urlParams","_inherits","_this2","bind","EVENTS","stop","URLSearchParams","window","location","search","get","parseAnimationSpeed","toggle","_this3","jIcons","$","filter","on","_this4","overrides","undefined","trigger","bComingFrom1up","constMode2up","mode","switchMode","timer","pageProgression","next","triggerStop","hide","show","setInterval","animating","Math","max","twoPage","currentIndexL","currentIndexR","book","getNumLeafs","prev","clearInterval","BookReader","registerPlugin"],"sourceRoot":""}